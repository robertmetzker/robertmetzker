

      create or replace  table DEV_EDW.EDW_STAGING_DIM.DIM_FINANCIAL_TRANSACTION_STATUS  as
      (


 WITH  SCD AS ( 
	SELECT  UNIQUE_ID_KEY,
     last_value(FINANCIAL_TRANSACTION_STATUS_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as FINANCIAL_TRANSACTION_STATUS_CODE, 
     last_value(FINANCIAL_TRANSACTION_STATUS_DESC) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as FINANCIAL_TRANSACTION_STATUS_DESC
     
	FROM EDW_STAGING.DIM_FINANCIAL_TRANSACTION_STATUS_SCDALL_STEP2),
    
    ------------- ETL LAYER -----------
ETL AS (select 
    md5(cast(
    
    coalesce(cast(FINANCIAL_TRANSACTION_STATUS_CODE as 
    varchar
), '')

 as 
    varchar
)) as FINANCIAL_TRANSACTION_STATUS_HKEY
 , UNIQUE_ID_KEY
 , FINANCIAL_TRANSACTION_STATUS_CODE
 , FINANCIAL_TRANSACTION_STATUS_DESC
 , CURRENT_TIMESTAMP AS LOAD_DATETIME
 , try_to_TIMESTAMP('Invalid')  AS UPDATE_DATETIME
 , 'CORESUITE' AS PRIMARY_SOURCE_SYSTEM
 from SCD)

SELECT * FROM ETL
      );
    