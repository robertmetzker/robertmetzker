

      create or replace  table DEV_EDW.EDW_STAGING_DIM.DIM_CATASTROPHIC_INJURY_TYPE  as
      (

 WITH  SCD AS ( 
	SELECT  md5(cast(
    
    coalesce(cast(CATASTROPHIC_INJURY_TYPE_CODE as 
    varchar
), '')

 as 
    varchar
)) AS UNIQUE_ID_KEY,
     last_value(CATASTROPHIC_INJURY_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as CATASTROPHIC_INJURY_TYPE_CODE, 
     last_value(CATASTROPHIC_INJURY_TYPE_DESC) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as CATASTROPHIC_INJURY_TYPE_DESC
    
	FROM EDW_STAGING.DIM_CATASTROPHIC_INJURY_TYPE_SCDALL_STEP2)

select DISTINCT
md5(cast(
    
    coalesce(cast(CATASTROPHIC_INJURY_TYPE_CODE as 
    varchar
), '')

 as 
    varchar
)) AS CATASTROPHIC_INJURY_TYPE_HKEY
,UNIQUE_ID_KEY
,CATASTROPHIC_INJURY_TYPE_CODE
,CATASTROPHIC_INJURY_TYPE_DESC
,CURRENT_TIMESTAMP AS  LOAD_DATETIME
,TRY_TO_TIMESTAMP('Invalid') AS UPDATE_DATETIME
,'CORESUITE' AS PRIMARY_SOURCE_SYSTEM 
 from SCD
      );
    