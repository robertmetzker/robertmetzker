

      create or replace  table DEV_EDW.STAGING.STG_NDC_FRMLRY_CVRG_DESC  as
      (WITH
SRC_ONLC as ( SELECT *     from      DEV_VIEWS.DBEABP00.TEAONLC )
----LOGIC LAYER----
,
LOGIC_ONLC as ( SELECT 
		--TRIM(FK_NDCL_CODE) AS FK_NDCL_CODE,
		CASE WHEN TRIM(FK_NDCL_CODE)='' THEN NULL ELSE TRIM(FK_NDCL_CODE) END AS FK_NDCL_CODE,
		--TRIM(FK_DCPR_CODE) AS FK_DCPR_CODE,
		CASE WHEN TRIM(FK_DCPR_CODE)='' THEN NULL ELSE TRIM(FK_DCPR_CODE) END AS FK_DCPR_CODE,
		--TRIM(FK_NDCP_CODE) AS FK_NDCP_CODE,
		CASE WHEN TRIM(FK_NDCP_CODE)='' THEN NULL ELSE TRIM(FK_NDCP_CODE) END AS FK_NDCP_CODE,
		FK_NDCV_NMBR AS FK_NDCV_NMBR,
		ONLC_CRT_DTTM AS ONLC_CRT_DTTM,
		--TRIM(DESCR) AS DESCR,
		CASE WHEN TRIM(DESCR)='' THEN NULL ELSE TRIM(DESCR) END AS DESCR,
		cast(EFCTV_DATE as DATE) AS EFCTV_DATE,
		cast(ENDNG_DATE as DATE) AS ENDNG_DATE,
		--TRIM(CRT_USER_CODE) AS CRT_USER_CODE,
		CASE WHEN TRIM(CRT_USER_CODE)='' THEN NULL ELSE TRIM(CRT_USER_CODE) END AS CRT_USER_CODE,
		--TRIM(CRT_PRGRM_NAME) AS CRT_PRGRM_NAME,
		CASE WHEN TRIM(CRT_PRGRM_NAME)='' THEN NULL ELSE TRIM(CRT_PRGRM_NAME) END AS CRT_PRGRM_NAME,
		--TRIM(DCTVT_USER_CODE) AS DCTVT_USER_CODE,
		CASE WHEN TRIM(DCTVT_USER_CODE)='' THEN NULL ELSE TRIM(DCTVT_USER_CODE) END AS DCTVT_USER_CODE,
		--TRIM(DCTVT_PRGRM_NAME) AS DCTVT_PRGRM_NAME,
		CASE WHEN TRIM(DCTVT_PRGRM_NAME)='' THEN NULL ELSE TRIM(DCTVT_PRGRM_NAME) END AS DCTVT_PRGRM_NAME,
		DCTVT_DTTM AS DCTVT_DTTM 
				from SRC_ONLC
            )
----RENAME LAYER ----
,
RENAME_ONLC as ( SELECT FK_NDCL_CODE AS FK_NDCL_CODE,FK_DCPR_CODE AS FK_DCPR_CODE,FK_NDCP_CODE AS FK_NDCP_CODE,FK_NDCV_NMBR AS FK_NDCV_NMBR,ONLC_CRT_DTTM AS ONLC_CRT_DTTM,DESCR AS DESCR,EFCTV_DATE AS EFCTV_DATE,ENDNG_DATE AS ENDNG_DATE,CRT_USER_CODE AS CRT_USER_CODE,CRT_PRGRM_NAME AS CRT_PRGRM_NAME,DCTVT_USER_CODE AS DCTVT_USER_CODE,DCTVT_PRGRM_NAME AS DCTVT_PRGRM_NAME,DCTVT_DTTM AS DCTVT_DTTM 
			from      LOGIC_ONLC
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_ONLC as ( SELECT  * 
			from     RENAME_ONLC 
            
        )
----JOIN LAYER----
,
 JOIN_ONLC as ( SELECT * 
			from  FILTER_ONLC )
 SELECT * FROM JOIN_ONLC
      );
    