

      create or replace  table DEV_EDW.STAGING.STG_CLAIM_ALIAS_NUMBER  as
      (----SRC LAYER----
WITH
SRC_CAN as ( SELECT *     from      DEV_VIEWS.PCMP.CLAIM_ALIAS_NUMBER  ),
SRC_CANT as ( SELECT *     from      DEV_VIEWS.PCMP.CLAIM_ALIAS_NUMBER_TYPE )
----LOGIC LAYER----
,
LOGIC_CAN as ( SELECT 
		CLM_ALIAS_NO_ID AS CLM_ALIAS_NO_ID,
		AGRE_ID AS AGRE_ID,
		UPPER(TRIM(CLM_ALIAS_NO_TYP_CD)) AS CLM_ALIAS_NO_TYP_CD,
		UPPER(TRIM(CLM_ALIAS_NO_NO)) AS CLM_ALIAS_NO_NO,
		AUDIT_USER_ID_CREA AS AUDIT_USER_ID_CREA,
		AUDIT_USER_CREA_DTM AS AUDIT_USER_CREA_DTM,
		AUDIT_USER_ID_UPDT AS AUDIT_USER_ID_UPDT,
		AUDIT_USER_UPDT_DTM AS AUDIT_USER_UPDT_DTM,
		UPPER(VOID_IND) AS VOID_IND 
				from SRC_CAN
            ),
LOGIC_CANT as ( SELECT 
		UPPER(TRIM(CLM_ALIAS_NO_TYP_NM)) AS CLM_ALIAS_NO_TYP_NM,
		UPPER(TRIM(CLM_ALIAS_NO_TYP_CD)) AS CLM_ALIAS_NO_TYP_CD,
		UPPER(VOID_IND) AS VOID_IND 
				from SRC_CANT
            )
----RENAME LAYER ----
,
RENAME_CAN as ( SELECT CLM_ALIAS_NO_ID AS CLM_ALIAS_NO_ID,AGRE_ID AS AGRE_ID,CLM_ALIAS_NO_TYP_CD AS CLM_ALIAS_NO_TYP_CD,CLM_ALIAS_NO_NO AS CLM_ALIAS_NO_NO,AUDIT_USER_ID_CREA AS AUDIT_USER_ID_CREA,AUDIT_USER_CREA_DTM AS AUDIT_USER_CREA_DTM,AUDIT_USER_ID_UPDT AS AUDIT_USER_ID_UPDT,AUDIT_USER_UPDT_DTM AS AUDIT_USER_UPDT_DTM,VOID_IND AS VOID_IND 
			from      LOGIC_CAN
        ),
RENAME_CANT as ( SELECT CLM_ALIAS_NO_TYP_NM AS CLM_ALIAS_NO_TYP_NM,
			
			CLM_ALIAS_NO_TYP_CD AS CANT_CLM_ALIAS_NO_TYP_CD,
			
			VOID_IND AS CANT_VOID_IND 
			from      LOGIC_CANT
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_CAN as ( SELECT  * 
			from     RENAME_CAN 
            
        ),

        FILTER_CANT as ( SELECT  * 
			from     RENAME_CANT 
            WHERE CANT_VOID_IND = 'N'
        )
----JOIN LAYER----
,
CAN as ( SELECT * 
			from  FILTER_CAN
				INNER JOIN FILTER_CANT ON FILTER_CAN.CLM_ALIAS_NO_TYP_CD = FILTER_CANT.CANT_CLM_ALIAS_NO_TYP_CD  )
select * from CAN
      );
    