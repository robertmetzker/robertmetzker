

      create or replace  table DEV_EDW.STAGING.STG_PROVIDER_TYPE  as
      (----SRC LAYER----
WITH
SRC_PRTE as ( SELECT *     from      DEV_VIEWS.DBMOBP00.TMPPRTE ),
SRC_PRVT as ( SELECT *     from      DEV_VIEWS.DBMOBP00.TMPPRVT ),

----LOGIC LAYER----

LOGIC_PRTE as ( SELECT 
		cast(PRVDR_BASE_NMBR as TEXT) AS PRVDR_BASE_NMBR,
		lpad(cast(PRVDR_SFX_NMBR as TEXT),4,'0') AS PRVDR_SFX_NMBR,
		PRTE_CRT_DTTM AS PRTE_CRT_DTTM,
		UPPER(TRIM(PRVDR_TYPE_CODE)) AS PRVDR_TYPE_CODE,
		UPPER(TRIM(CRT_USER_CODE)) AS CRT_USER_CODE,
		DCTVT_DTTM AS DCTVT_DTTM,
		UPPER(TRIM(DCTVT_USER_CODE)) AS DCTVT_USER_CODE,
		UPPER(TRIM(UPDT_PRGRM_NAME)) AS UPDT_PRGRM_NAME 
				from SRC_PRTE
            ),
LOGIC_PRVT as ( SELECT 
		UPPER(TRIM(PRVDR_TYPE_NAME)) AS PRVDR_TYPE_NAME,
		CRT_DTTM AS CRT_DTTM,
		UPPER(TRIM(CRT_USER_CODE)) AS CRT_USER_CODE,
		cast(DCTVT_DTTM as DATE) AS DCTVT_DTTM,
		UPPER(TRIM(DCTVT_USER_CODE)) AS DCTVT_USER_CODE,
		UPPER(TRIM(UPDT_PRGRM_NAME)) AS UPDT_PRGRM_NAME,
		UPPER(TRIM(PRVDR_TYPE_CODE)) AS PRVDR_TYPE_CODE 
				from SRC_PRVT
            )
----RENAME LAYER ----
,
RENAME_PRTE as ( SELECT PRVDR_BASE_NMBR AS PRVDR_BASE_NMBR,PRVDR_SFX_NMBR AS PRVDR_SFX_NMBR,PRTE_CRT_DTTM AS PRTE_CRT_DTTM,PRVDR_TYPE_CODE AS PRVDR_TYPE_CODE,CRT_USER_CODE AS CRT_USER_CODE,DCTVT_DTTM AS DCTVT_DTTM,DCTVT_USER_CODE AS DCTVT_USER_CODE,UPDT_PRGRM_NAME AS UPDT_PRGRM_NAME 
			from      LOGIC_PRTE
        ),
RENAME_PRVT as ( SELECT PRVDR_TYPE_NAME AS PRVDR_TYPE_NAME,CRT_DTTM AS CRT_DTTM,
			
			CRT_USER_CODE AS PRVT_CRT_USER_CODE,
			
			DCTVT_DTTM AS PRVT_DCTVT_DTTM,
			
			DCTVT_USER_CODE AS PRVT_DCTVT_USER_CODE,
			
			UPDT_PRGRM_NAME AS PRVT_UPDT_PRGRM_NAME,
			
			PRVDR_TYPE_CODE AS PRVT_PRVDR_TYPE_CODE 
			from      LOGIC_PRVT
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_PRTE as ( SELECT  * 
			from     RENAME_PRTE 
            
        ),

        FILTER_PRVT as ( SELECT  * 
			from     RENAME_PRVT 
            
        )
----JOIN LAYER----
,
PRTE as ( SELECT * 
			from  FILTER_PRTE
				INNER JOIN FILTER_PRVT ON FILTER_PRTE.PRVDR_TYPE_CODE = FILTER_PRVT.PRVT_PRVDR_TYPE_CODE  )
select * from PRTE
      );
    