

      create or replace  table DEV_EDW.STAGING.STG_INVOICE_HEADER_PHARM  as
      (----SRC LAYER----
WITH
SRC_IHP as ( SELECT *     from      DEV_VIEWS.BASE.INVOICE_HEADER_PHARM )
//SRC_IHP as ( SELECT *     from      INVOICE_HEADER_PHARM)
----LOGIC LAYER----
,
LOGIC_IHP as ( SELECT 
		INVOICE_HEADER_ID AS INVOICE_HEADER_ID,
		TRIM(CLAIM_STATUS) AS CLAIM_STATUS,
		TRIM(PROVIDER_LOCK) AS PROVIDER_LOCK,
		TRIM(PLAN_CODE) AS PLAN_CODE,
		TRIM(ORIGINATION_FLAG) AS ORIGINATION_FLAG,
		TRIM(SPECIAL_PROGRAM) AS SPECIAL_PROGRAM 
				from SRC_IHP
            )
----RENAME LAYER ----
,
RENAME_IHP as ( SELECT INVOICE_HEADER_ID AS INVOICE_HEADER_ID,CLAIM_STATUS AS CLAIM_STATUS,PROVIDER_LOCK AS PROVIDER_LOCK,PLAN_CODE AS PLAN_CODE,ORIGINATION_FLAG AS ORIGINATION_FLAG,SPECIAL_PROGRAM AS SPECIAL_PROGRAM 
			from      LOGIC_IHP
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_IHP as ( SELECT  * 
			from     RENAME_IHP 
            
        )
----JOIN LAYER----
,
 JOIN_IHP as ( SELECT * 
			from  FILTER_IHP )
 SELECT * FROM JOIN_IHP
      );
    