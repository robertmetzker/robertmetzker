

      create or replace  table DEV_EDW.STAGING.STG_INVOICE_LINE_PH_CL  as
      (----SRC LAYER----
WITH
SRC_PHCL as ( SELECT *     from      DEV_VIEWS.BASE.INVOICE_LINE_PH_CL ),
----LOGIC LAYER----
LOGIC_PHCL as ( SELECT 
		INVOICE_LINE_ID AS INVOICE_LINE_ID,
		SEQUENCE_NUMBER AS SEQUENCE_NUMBER,
		TRIM(CLARIFICATION) AS CLARIFICATION 
				from SRC_PHCL
            )
----RENAME LAYER ----
,
RENAME_PHCL as ( SELECT INVOICE_LINE_ID AS INVOICE_LINE_ID,SEQUENCE_NUMBER AS SEQUENCE_NUMBER,CLARIFICATION AS CLARIFICATION 
			from      LOGIC_PHCL
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_PHCL as ( SELECT  * 
			from     RENAME_PHCL 
            WHERE SEQUENCE_NUMBER = 1
        )
----JOIN LAYER----
,
 JOIN_PHCL as ( SELECT * 
			from  FILTER_PHCL )
 SELECT * FROM JOIN_PHCL
      );
    