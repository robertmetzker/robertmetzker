
  create or replace  view DEV_EDW.STAGING.DSV_NDC_DRUG_PRICING  as (
     
----SRC LAYER----
WITH
SRC_NDC as ( SELECT *     from      STAGING.DST_NDC_DRUG_PRICING )
----LOGIC LAYER----
,
LOGIC_NDC as ( SELECT 
		NDC_11_CODE AS NDC_11_CODE,
		AMT AS AMT,
		FK_NDCL_CODE AS FK_NDCL_CODE,
		FK_DCPR_CODE AS FK_DCPR_CODE,
		FK_NDCP_CODE AS FK_NDCP_CODE,
		FK_NDCV_NMBR AS FK_NDCV_NMBR,
		NAME AS NAME,
		FK_NDPT_CODE AS FK_NDPT_CODE,
		EFCTV_DATE AS EFCTV_DATE,
		ENDNG_DATE AS ENDNG_DATE 
				from SRC_NDC
            )
----RENAME LAYER ----
,
RENAME_NDC as ( SELECT NDC_11_CODE AS NDC_11_CODE,
			
			AMT AS DRUG_AMOUNT,FK_NDCL_CODE AS NDC_5_LABELER_CODE,FK_DCPR_CODE AS NDC_4_PRODUCT_CODE
					, FK_NDCP_CODE AS NDC_2_PACKAGE_CODE,FK_NDCV_NMBR AS NDC_VERSION_NUMBER,
			
			NAME AS PRICE_TYPE_DESC,
			
			FK_NDPT_CODE AS PRICE_TYPE_CODE,
			
			EFCTV_DATE AS EFFECTIVE_DATE,
			
			ENDNG_DATE AS END_DATE 
			from      LOGIC_NDC
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_NDC as ( SELECT  * 
			from     RENAME_NDC 
            
        )
----JOIN LAYER----
,
 JOIN_NDC as ( SELECT * 
			from  FILTER_NDC )
 SELECT * FROM JOIN_NDC
  );
