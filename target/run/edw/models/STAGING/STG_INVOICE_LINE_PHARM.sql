

      create or replace  table DEV_EDW.STAGING.STG_INVOICE_LINE_PHARM  as
      (----SRC LAYER----
WITH
SRC_PBM as ( SELECT *     from      DEV_VIEWS.BASE.INVOICE_LINE_PHARM ),
----LOGIC LAYER----
LOGIC_PBM as ( SELECT 
		INVOICE_LINE_ID AS INVOICE_LINE_ID,
		PRESCRIBED_DATE AS PRESCRIBED_DATE,
		TRIM(PRESCRIPTION_NUMBER) AS PRESCRIPTION_NUMBER,
		DAYS_SUPPLY AS DAYS_SUPPLY,
		REFILL_IND AS REFILL_IND,
		TRIM(GENERIC_DRUG_IND) AS GENERIC_DRUG_IND,
		TRIM(COMPOUND_IND) AS COMPOUND_IND,
		TRIM(SERVICE_CODE_TYPE) AS SERVICE_CODE_TYPE,
		TRIM(FORMULARY_FLAG) AS FORMULARY_FLAG,
		TRIM(DRUG_STATUS) AS DRUG_STATUS,
		SUB_DISPENSING_FEE AS SUB_DISPENSING_FEE,
		TOTAL_SALES_TAX AS TOTAL_SALES_TAX,
		INCENTIVE_FEE AS INCENTIVE_FEE,
		TRIM(CLIENT_PRICING) AS CLIENT_PRICING,
		INGREDIENT_COST AS INGREDIENT_COST,
		DISPENSING_FEE AS DISPENSING_FEE,
		SALES_TAX AS SALES_TAX,
		TRIM(PRICE_TYPE) AS PRICE_TYPE,
		ADMIN_FEE AS ADMIN_FEE,
		DRUG_QUANTITY AS DRUG_QUANTITY,
		TRIM(GPI) AS GPI,
		TRIM(SERVICE_LEVEL) AS SERVICE_LEVEL,
		REBATE_AMOUNT AS REBATE_AMOUNT,
		REBATE_DATE AS REBATE_DATE,
		REASON_SERVICE AS REASON_SERVICE,
		TRIM(PROF_SERVICE) AS PROF_SERVICE,
		TRIM(RESULT_SERVICE) AS RESULT_SERVICE,
		TRIM(ROUTE_ADMINISTRATION) AS ROUTE_ADMINISTRATION,
		GROSS_AMOUNT AS GROSS_AMOUNT,
		QUANTITY_PRESCRIBED AS QUANTITY_PRESCRIBED,
		ING_COST_SUBMITTED AS ING_COST_SUBMITTED,
		PA_EFF_DATE AS PA_EFF_DATE,
		PA_EXP_DATE AS PA_EXP_DATE 
				from SRC_PBM
            )
----RENAME LAYER ----
,
RENAME_PBM as ( SELECT INVOICE_LINE_ID AS INVOICE_LINE_ID,PRESCRIBED_DATE AS PRESCRIBED_DATE,PRESCRIPTION_NUMBER AS PRESCRIPTION_NUMBER,DAYS_SUPPLY AS DAYS_SUPPLY,REFILL_IND AS REFILL_IND,GENERIC_DRUG_IND AS GENERIC_DRUG_IND,COMPOUND_IND AS COMPOUND_IND,SERVICE_CODE_TYPE AS SERVICE_CODE_TYPE,FORMULARY_FLAG AS FORMULARY_FLAG,DRUG_STATUS AS DRUG_STATUS,SUB_DISPENSING_FEE AS SUB_DISPENSING_FEE,TOTAL_SALES_TAX AS TOTAL_SALES_TAX,INCENTIVE_FEE AS INCENTIVE_FEE,CLIENT_PRICING AS CLIENT_PRICING,INGREDIENT_COST AS INGREDIENT_COST,DISPENSING_FEE AS DISPENSING_FEE,SALES_TAX AS SALES_TAX,PRICE_TYPE AS PRICE_TYPE,ADMIN_FEE AS ADMIN_FEE,DRUG_QUANTITY AS DRUG_QUANTITY,GPI AS GPI,SERVICE_LEVEL AS SERVICE_LEVEL,REBATE_AMOUNT AS REBATE_AMOUNT,REBATE_DATE AS REBATE_DATE,REASON_SERVICE AS REASON_SERVICE,PROF_SERVICE AS PROF_SERVICE,RESULT_SERVICE AS RESULT_SERVICE,ROUTE_ADMINISTRATION AS ROUTE_ADMINISTRATION,GROSS_AMOUNT AS GROSS_AMOUNT,QUANTITY_PRESCRIBED AS QUANTITY_PRESCRIBED,ING_COST_SUBMITTED AS ING_COST_SUBMITTED,PA_EFF_DATE AS PA_EFF_DATE,PA_EXP_DATE AS PA_EXP_DATE 
			from      LOGIC_PBM
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_PBM as ( SELECT  * 
			from     RENAME_PBM 
            
        )
----JOIN LAYER----
,
 JOIN_PBM as ( SELECT * 
			from  FILTER_PBM )
 SELECT * FROM JOIN_PBM
      );
    