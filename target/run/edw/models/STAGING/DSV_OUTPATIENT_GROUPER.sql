
  create or replace  view DEV_EDW.STAGING.DSV_OUTPATIENT_GROUPER  as (
     
----SRC LAYER----
WITH
SRC_OUT as ( SELECT *     from      STAGING.DST_OUTPATIENT_GROUPER )
//SRC_OUT as ( SELECT *     from      DST_OUTPATIENT_GROUPER)
----LOGIC LAYER----
,
LOGIC_OUT as ( SELECT 
		UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
		STATUS AS STATUS,
		NON_OPPS_BILL_TYPE AS NON_OPPS_BILL_TYPE,
		OPPS_FLAG AS OPPS_FLAG,
		PAYMENT_METHOD AS PAYMENT_METHOD,
		DISCOUNT AS DISCOUNT,
		COMPOSITE_ADJUSTMENT AS COMPOSITE_ADJUSTMENT,
		PAYMENT_INDICATOR AS PAYMENT_INDICATOR,
		PACKAGING AS PACKAGING,
		PAYMENT_ADJUSTMENT AS PAYMENT_ADJUSTMENT,
		APC_STATUS_INDICATOR_DESC AS APC_STATUS_INDICATOR_DESC,
		OPPS_RETURN_DESC AS OPPS_RETURN_DESC,
		OPPS_DESC AS OPPS_DESC,
		OPPS_PAYMENT_METHOD_DESC AS OPPS_PAYMENT_METHOD_DESC,
		APC_DISCOUNTING_FRACTION_DESC AS APC_DISCOUNTING_FRACTION_DESC,
		APC_COMPOSITE_ADJUSTMENT_DESC AS APC_COMPOSITE_ADJUSTMENT_DESC,
		APC_PAYMENT_INDICATOR_DESC AS APC_PAYMENT_INDICATOR_DESC,
		APC_PACKAGING_DESC AS APC_PACKAGING_DESC,
		APC_PAYMENT_ADJUSTMENT_DESC AS APC_PAYMENT_ADJUSTMENT_DESC 
				from SRC_OUT
            )
----RENAME LAYER ----
,
RENAME_OUT as ( SELECT UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
			
			STATUS AS APC_STATUS_INDICATOR_CODE,
			
			NON_OPPS_BILL_TYPE AS OPPS_RETURN_CODE,
			
			OPPS_FLAG AS OPPS_CODE,
			
			PAYMENT_METHOD AS OPPS_PAYMENT_METHOD_CODE,
			
			DISCOUNT AS APC_DISCOUNTING_FRACTION_CODE,
			
			COMPOSITE_ADJUSTMENT AS APC_COMPOSITE_ADJUSTMENT_CODE,
			
			PAYMENT_INDICATOR AS APC_PAYMENT_INDICATOR_CODE,
			
			PACKAGING AS APC_PACKAGING_CODE,
			
			PAYMENT_ADJUSTMENT AS APC_PAYMENT_ADJUSTMENT_CODE,APC_STATUS_INDICATOR_DESC AS APC_STATUS_INDICATOR_DESC,OPPS_RETURN_DESC AS OPPS_RETURN_DESC,OPPS_DESC AS OPPS_DESC,OPPS_PAYMENT_METHOD_DESC AS OPPS_PAYMENT_METHOD_DESC,APC_DISCOUNTING_FRACTION_DESC AS APC_DISCOUNTING_FRACTION_DESC,APC_COMPOSITE_ADJUSTMENT_DESC AS APC_COMPOSITE_ADJUSTMENT_DESC,APC_PAYMENT_INDICATOR_DESC AS APC_PAYMENT_INDICATOR_DESC,APC_PACKAGING_DESC AS APC_PACKAGING_DESC,APC_PAYMENT_ADJUSTMENT_DESC AS APC_PAYMENT_ADJUSTMENT_DESC 
			from      LOGIC_OUT
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_OUT as ( SELECT  * 
			from     RENAME_OUT 
            
        )
----JOIN LAYER----
,
 JOIN_OUT as ( SELECT * 
			from  FILTER_OUT )
 SELECT * FROM JOIN_OUT
  );
