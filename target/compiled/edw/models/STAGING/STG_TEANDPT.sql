----SRC LAYER----
WITH
SRC_TEA as ( SELECT *     from      DEV_VIEWS.DBEABP00.TEANDPT )
//SRC_TEA as ( SELECT *     from      TEANDPT)
----LOGIC LAYER----
,
LOGIC_TEA as ( SELECT 
		NDPT_CODE AS NDPT_CODE,
		CRT_DTTM AS CRT_DTTM,
		NAME AS NAME,
		EFCTV_DATE AS EFCTV_DATE,
		ENDNG_DATE AS ENDNG_DATE,
		DCTVT_DTTM AS DCTVT_DTTM,
		CRT_USER_CODE AS CRT_USER_CODE,
		CRT_PRGRM_NAME AS CRT_PRGRM_NAME,
		DCTVT_USER_CODE AS DCTVT_USER_CODE,
		DCTVT_PRGRM_NAME AS DCTVT_PRGRM_NAME,
		UPDT_DTTM::timestamp AS UPDT_DTTM,
		UPDT_USER_CODE AS UPDT_USER_CODE,
		UPDT_PRGRM_NAME AS UPDT_PRGRM_NAME 
				from SRC_TEA
            )
----RENAME LAYER ----
,
RENAME_TEA as ( SELECT NDPT_CODE AS NDPT_CODE,CRT_DTTM AS CRT_DTTM,NAME AS NAME,EFCTV_DATE AS EFCTV_DATE,ENDNG_DATE AS ENDNG_DATE,DCTVT_DTTM AS DCTVT_DTTM,CRT_USER_CODE AS CRT_USER_CODE,CRT_PRGRM_NAME AS CRT_PRGRM_NAME,DCTVT_USER_CODE AS DCTVT_USER_CODE,DCTVT_PRGRM_NAME AS DCTVT_PRGRM_NAME,UPDT_DTTM AS UPDT_DTTM,UPDT_USER_CODE AS UPDT_USER_CODE,UPDT_PRGRM_NAME AS UPDT_PRGRM_NAME 
			from      LOGIC_TEA
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_TEA as ( SELECT  * 
			from     RENAME_TEA 
            
        )
----JOIN LAYER----
,
 JOIN_TEA as ( SELECT * 
			from  FILTER_TEA )
 SELECT * FROM JOIN_TEA