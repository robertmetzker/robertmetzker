 
----SRC LAYER----
WITH
SRC_IW as ( SELECT *     from      STAGING.DST_INJURED_WORKER )
//SRC_IW as ( SELECT *     from      DST_INJURED_WORKER)
----LOGIC LAYER----
,
LOGIC_IW as ( SELECT 
		UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
		CUST_ID as CUST_ID, 
		CUST_NO AS CUST_NO,
		CUST_NM_TTL_TYP_NM AS CUST_NM_TTL_TYP_NM,
		CUST_NM_FST AS CUST_NM_FST,
		CUST_NM_MID AS CUST_NM_MID,
		CUST_NM_LST AS CUST_NM_LST,
		CUST_NM_SFX_TYP_NM AS CUST_NM_SFX_TYP_NM,
		CUST_NM_NM AS CUST_NM_NM,
		TAX_ID_TYP_CD                                      as                                      TAX_ID_TYP_CD,
		TAX_ID_NO                                          as                                          TAX_ID_NO,
		TAX_ID_SEQ_NO                                      as                                      TAX_ID_SEQ_NO,
		FORMATTED_TAX_ID_NO                                as                                FORMATTED_TAX_ID_NO,
		GNDR_TYP_CD AS GNDR_TYP_CD,
		GNDR_TYP_NM AS GNDR_TYP_NM,
		MAR_STS_TYP_CD AS MAR_STS_TYP_CD,
		MAR_STS_TYP_NM AS MAR_STS_TYP_NM,
		PRSN_BIRTH_DATE AS PRSN_BIRTH_DATE,
		CUST_SOC_SEC_RET_DTL_DT AS CUST_SOC_SEC_RET_DTL_DT,
		PRSN_DEATH_DATE AS PRSN_DEATH_DATE,
		CUST_FRGN_CITZ_IND AS CUST_FRGN_CITZ_IND,
		LANG_TYP_NM AS LANG_TYP_NM,
		DOCUMENT_BLOCK_IND AS DOCUMENT_BLOCK_IND,
		THREAT_BEHAVIOR_BLOCK_IND AS THREAT_BEHAVIOR_BLOCK_IND,
		PHYSICAL_STREET_ADDRESS_1 AS PHYSICAL_STREET_ADDRESS_1,
		PHYSICAL_STREET_ADDRESS_2 AS PHYSICAL_STREET_ADDRESS_2,
		PHYSICAL_ADDRESS_CITY_NAME AS PHYSICAL_ADDRESS_CITY_NAME,
		PHYSICAL_ADDRESS_STATE_CODE AS PHYSICAL_ADDRESS_STATE_CODE,
		PHYSICAL_ADDRESS_STATE_NAME AS PHYSICAL_ADDRESS_STATE_NAME,
		PHYSICAL_ADDRESS_POSTAL_CODE AS PHYSICAL_ADDRESS_POSTAL_CODE,
		PHYSICAL_FORMATTED_ADDRESS_POSTAL_CODE AS PHYSICAL_FORMATTED_ADDRESS_POSTAL_CODE,
		PHYSICAL_FORMATTED_ADDRESS_ZIP_CODE AS PHYSICAL_FORMATTED_ADDRESS_ZIP_CODE,
		PHYSICAL_FORMATTED_ADDRESS_ZIP4_CODE AS PHYSICAL_FORMATTED_ADDRESS_ZIP4_CODE,
		PHYSICAL_ADDRESS_COUNTY_NAME AS PHYSICAL_ADDRESS_COUNTY_NAME,
		PHYSICAL_ADDRESS_COUNTRY_NAME AS PHYSICAL_ADDRESS_COUNTRY_NAME,
		PHYSICAL_ADDRESS_VALIDATED_IND AS PHYSICAL_ADDRESS_VALIDATED_IND,
		PHYSICAL_ADDRESS_COMMENT_TEXT AS PHYSICAL_ADDRESS_COMMENT_TEXT,
		MAILING_STREET_ADDRESS_1 AS MAILING_STREET_ADDRESS_1,
		MAILING_STREET_ADDRESS_2 AS MAILING_STREET_ADDRESS_2,
		MAILING_ADDRESS_CITY_NAME AS MAILING_ADDRESS_CITY_NAME,
		MAILING_ADDRESS_STATE_CODE AS MAILING_ADDRESS_STATE_CODE,
		MAILING_ADDRESS_STATE_NAME AS MAILING_ADDRESS_STATE_NAME,
		MAILING_ADDRESS_POSTAL_CODE AS MAILING_ADDRESS_POSTAL_CODE,
		MAILING_FORMATTED_ADDRESS_POSTAL_CODE AS MAILING_FORMATTED_ADDRESS_POSTAL_CODE,
		MAILING_FORMATTED_ADDRESS_ZIP_CODE AS MAILING_FORMATTED_ADDRESS_ZIP_CODE,
		MAILING_FORMATTED_ADDRESS_ZIP4_CODE AS MAILING_FORMATTED_ADDRESS_ZIP4_CODE,
		MAILING_ADDRESS_COUNTY_NAME AS MAILING_ADDRESS_COUNTY_NAME,
		MAILING_ADDRESS_COUNTRY_NAME AS MAILING_ADDRESS_COUNTRY_NAME,
		MAILING_ADDRESS_VALIDATED_IND AS MAILING_ADDRESS_VALIDATED_IND,
		MAILING_ADDRESS_COMMENT_TEXT AS MAILING_ADDRESS_COMMENT_TEXT,
		PTCP_TYP_CD AS PTCP_TYP_CD,
		PTCP_TYP_NM AS PTCP_TYP_NM 
		, DEATH_ENTRY_DATE as DEATH_ENTRY_DATE 

				from SRC_IW
            )
----RENAME LAYER ----
,
RENAME_IW as ( SELECT UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
			CUST_ID as CUST_ID,
			CUST_NO AS CUSTOMER_NUMBER,
			CUST_NM_TTL_TYP_NM AS COURTESY_TITLE_NAME,
			CUST_NM_FST AS FIRST_NAME,
			CUST_NM_MID AS MIDDLE_NAME,
			CUST_NM_LST AS LAST_NAME,
			CUST_NM_SFX_TYP_NM AS SUFFIX_NAME,
			CUST_NM_NM AS FULL_NAME,
TAX_ID_TYP_CD as TAX_ID_TYPE,
TAX_ID_NO as TAX_ID_NUMBER,
TAX_ID_SEQ_NO as TAX_ID_SEQUENCE_NUMBER,
FORMATTED_TAX_ID_NO as FORMATTED_TAX_ID_NUMBER,
			GNDR_TYP_CD AS GENDER_TYPE_CODE,
			GNDR_TYP_NM AS GENDER_TYPE_DESC,
			MAR_STS_TYP_CD AS MARITAL_STATUS_TYPE_CODE,
			MAR_STS_TYP_NM AS MARITAL_STATUS_TYPE_DESC,
			PRSN_BIRTH_DATE AS BIRTH_DATE,
			CUST_SOC_SEC_RET_DTL_DT AS RETIREMENT_DATE,
			PRSN_DEATH_DATE AS DEATH_DATE,
			CUST_FRGN_CITZ_IND AS FOREIGN_CITIZEN_IND,
			LANG_TYP_NM AS PRIMARY_LANGUAGE_TYPE_DESC,
			DOCUMENT_BLOCK_IND AS DOCUMENT_BLOCK_IND,
			THREAT_BEHAVIOR_BLOCK_IND AS THREATENING_BEHAVIOR_BLOCK_IND,
			PHYSICAL_STREET_ADDRESS_1 AS PHYSICAL_STREET_ADDRESS_1,
			PHYSICAL_STREET_ADDRESS_2 AS PHYSICAL_STREET_ADDRESS_2,
			PHYSICAL_ADDRESS_CITY_NAME AS PHYSICAL_ADDRESS_CITY_NAME,
			PHYSICAL_ADDRESS_STATE_CODE AS PHYSICAL_ADDRESS_STATE_CODE,
			PHYSICAL_ADDRESS_STATE_NAME AS PHYSICAL_ADDRESS_STATE_NAME,
			PHYSICAL_ADDRESS_POSTAL_CODE AS PHYSICAL_ADDRESS_POSTAL_CODE,
			PHYSICAL_FORMATTED_ADDRESS_POSTAL_CODE AS PHYSICAL_FORMATTED_ADDRESS_POSTAL_CODE,
			PHYSICAL_FORMATTED_ADDRESS_ZIP_CODE AS PHYSICAL_FORMATTED_ADDRESS_ZIP_CODE,
			PHYSICAL_FORMATTED_ADDRESS_ZIP4_CODE AS PHYSICAL_FORMATTED_ADDRESS_ZIP4_CODE,
			PHYSICAL_ADDRESS_COUNTY_NAME AS PHYSICAL_ADDRESS_COUNTY_NAME,
			PHYSICAL_ADDRESS_COUNTRY_NAME AS PHYSICAL_ADDRESS_COUNTRY_NAME,
			PHYSICAL_ADDRESS_VALIDATED_IND AS PHYSICAL_ADDRESS_VALIDATED_IND,
			PHYSICAL_ADDRESS_COMMENT_TEXT AS PHYSICAL_ADDRESS_COMMENT_TEXT,
			MAILING_STREET_ADDRESS_1 AS MAILING_STREET_ADDRESS_1,
			MAILING_STREET_ADDRESS_2 AS MAILING_STREET_ADDRESS_2,
			MAILING_ADDRESS_CITY_NAME AS MAILING_ADDRESS_CITY_NAME,
			MAILING_ADDRESS_STATE_CODE AS MAILING_ADDRESS_STATE_CODE,
			MAILING_ADDRESS_STATE_NAME AS MAILING_ADDRESS_STATE_NAME,
			MAILING_ADDRESS_POSTAL_CODE AS MAILING_ADDRESS_POSTAL_CODE,
			MAILING_FORMATTED_ADDRESS_POSTAL_CODE AS MAILING_FORMATTED_ADDRESS_POSTAL_CODE,
			MAILING_FORMATTED_ADDRESS_ZIP_CODE AS MAILING_FORMATTED_ADDRESS_ZIP_CODE,
			MAILING_FORMATTED_ADDRESS_ZIP4_CODE AS MAILING_FORMATTED_ADDRESS_ZIP4_CODE,
			MAILING_ADDRESS_COUNTY_NAME AS MAILING_ADDRESS_COUNTY_NAME,
			MAILING_ADDRESS_COUNTRY_NAME AS MAILING_ADDRESS_COUNTRY_NAME,
			MAILING_ADDRESS_VALIDATED_IND AS MAILING_ADDRESS_VALIDATED_IND,
			MAILING_ADDRESS_COMMENT_TEXT AS MAILING_ADDRESS_COMMENT_TEXT,
			PTCP_TYP_CD AS PARTICIPATION_TYPE_CODE,
			PTCP_TYP_NM AS PARTICIPATION_TYPE_DESC,
			DEATH_ENTRY_DATE                                   as                                   DEATH_ENTRY_DATE 
			from      LOGIC_IW
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_IW as ( SELECT  * 
			from     RENAME_IW 
            
        )
----JOIN LAYER----
,
 JOIN_IW as ( SELECT * 
			from  FILTER_IW )
 SELECT * FROM JOIN_IW