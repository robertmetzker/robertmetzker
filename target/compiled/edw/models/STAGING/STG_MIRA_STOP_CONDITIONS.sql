----SRC LAYER----
WITH
SRC_MSCN as ( SELECT *     from      DEV_VIEWS.ACCESS_ACTUARIAL.MIRA_STOP_CONDITIONS_FINAL )
//SRC_MSCN as ( SELECT *     from      MIRA_STOP_CONDITIONS_FINAL)
----LOGIC LAYER----
,
LOGIC_MSCN as ( SELECT 
		TRIM(OICL_NMBR) AS OICL_NMBR,
		TRIM(CLSC_NMBR) AS CLSC_NMBR,  
        CAST(LAST_PREDICTION AS DATE) AS LAST_PREDICTION ,
		TRIM(INACTIVE_STATUS) AS INACTIVE_STATUS,
		FILING_DATE,
		TRIM(CLAIM_STATUS_CODE) AS CLAIM_STATUS_CODE,
		INJURY_DATE,
		TRIM(CLAIM_CATEGORY) AS CLAIM_CATEGORY,
		TRIM(C92_CODE) AS C92_CODE,
        CAST(C92_EFFECTIVE AS DATE) AS C92_EFFECTIVE,
		C92_END_DATE,
		LAST_MEDICAL_SERVICE_DATE,
		LAST_PRCNTG_PP_PAID_DATE,
		DEATH_DATE,
		TRIM(ACCIDENT_TYPE) AS ACCIDENT_TYPE,
		TRIM(ACCIDENT_RSLT_IN_DEATH) AS ACCIDENT_RSLT_IN_DEATH,
		TTL_MED_PAID_AMT,
		TTL_INDEM_PAID,
		TRIM(OPEN_CLOSE_IND) AS OPEN_CLOSE_IND,
		LAST_DEP_BNFT_TERM_DATE,
		DEATH_PAID_AMT,
		RTW_DATE,
		EST_RTW_DATE,
		MMI_DATE,
		LAST_PPD_PAY_DATE,
		PP_PAID_AMT,
		CO_PAID_WEEKS,
		CLAIM_STATUS_DATE,
		LAST_COMP_PAY_DATE,
		LAST_TT_PAY_DATE,
		LAST_LM_PAY_DATE,
		TRIM(MANUAL_CLASS_BASE_CODE) AS MANUAL_CLASS_BASE_CODE,
		LAST_DEATH_PAY_DATE,
		LAST_FD_PAY_DATE,
		LAST_DEATH_STOP_DATE,
		LAST_COMP_STOP_DATE,
		LAST_WL_STOP_DATE,
		LAST_TT_STOP_DATE,
		LAST_TP_STOP_DATE,
		LAST_PP_STOP_DATE,
		LAST_CO_STOP_DATE,
		LAST_FD_STOP_DATE,
		LAST_LM_STOP_DATE,
		TRIM(PD_STS_CODE) AS PD_STS_CODE,
		REHAB_DATE,
		TRIM(DEPENDENTS_QTY) AS DEPENDENTS_QTY,
		LAST_MED_PAY_DATE,
		LSS_AMOUNT,
		EXTRC_DATE,
		TRIM(FILE_NAME) AS FILE_NAME
		from SRC_MSCN
            )
----RENAME LAYER ----
,
RENAME_MSCN as ( SELECT OICL_NMBR AS OICL_NMBR,CLSC_NMBR AS CLSC_NMBR,EXTRC_DATE AS EXTRC_DATE,LAST_PREDICTION AS LAST_PREDICTION,INACTIVE_STATUS AS INACTIVE_STATUS,FILING_DATE AS FILING_DATE,CLAIM_STATUS_CODE AS CLAIM_STATUS_CODE,INJURY_DATE AS INJURY_DATE,CLAIM_CATEGORY AS CLAIM_CATEGORY,C92_CODE AS C92_CODE,C92_EFFECTIVE AS C92_EFFECTIVE,C92_END_DATE AS C92_END_DATE,LAST_MEDICAL_SERVICE_DATE AS LAST_MEDICAL_SERVICE_DATE,LAST_PRCNTG_PP_PAID_DATE AS LAST_PRCNTG_PP_PAID_DATE,DEATH_DATE AS DEATH_DATE,ACCIDENT_TYPE AS ACCIDENT_TYPE,ACCIDENT_RSLT_IN_DEATH AS ACCIDENT_RSLT_IN_DEATH,TTL_MED_PAID_AMT AS TTL_MED_PAID_AMT,TTL_INDEM_PAID AS TTL_INDEM_PAID,OPEN_CLOSE_IND AS OPEN_CLOSE_IND,LAST_DEP_BNFT_TERM_DATE AS LAST_DEP_BNFT_TERM_DATE,DEATH_PAID_AMT AS DEATH_PAID_AMT,RTW_DATE AS RTW_DATE,EST_RTW_DATE AS EST_RTW_DATE,MMI_DATE AS MMI_DATE,LAST_PPD_PAY_DATE AS LAST_PPD_PAY_DATE,PP_PAID_AMT AS PP_PAID_AMT,CO_PAID_WEEKS AS CO_PAID_WEEKS,CLAIM_STATUS_DATE AS CLAIM_STATUS_DATE,LAST_COMP_PAY_DATE AS LAST_COMP_PAY_DATE,LAST_TT_PAY_DATE AS LAST_TT_PAY_DATE,LAST_LM_PAY_DATE AS LAST_LM_PAY_DATE,MANUAL_CLASS_BASE_CODE AS MANUAL_CLASS_BASE_CODE,LAST_DEATH_PAY_DATE AS LAST_DEATH_PAY_DATE,LAST_FD_PAY_DATE AS LAST_FD_PAY_DATE,LAST_DEATH_STOP_DATE AS LAST_DEATH_STOP_DATE,LAST_COMP_STOP_DATE AS LAST_COMP_STOP_DATE,LAST_WL_STOP_DATE AS LAST_WL_STOP_DATE,LAST_TT_STOP_DATE AS LAST_TT_STOP_DATE,LAST_TP_STOP_DATE AS LAST_TP_STOP_DATE,LAST_PP_STOP_DATE AS LAST_PP_STOP_DATE,LAST_CO_STOP_DATE AS LAST_CO_STOP_DATE,LAST_FD_STOP_DATE AS LAST_FD_STOP_DATE,LAST_LM_STOP_DATE AS LAST_LM_STOP_DATE,PD_STS_CODE AS PD_STS_CODE,REHAB_DATE AS REHAB_DATE,DEPENDENTS_QTY AS DEPENDENTS_QTY,LAST_MED_PAY_DATE AS LAST_MED_PAY_DATE,LSS_AMOUNT AS LSS_AMOUNT,FILE_NAME AS FILE_NAME 
			from      LOGIC_MSCN
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_MSCN as ( SELECT  * 
			from     RENAME_MSCN 
            
        )
----JOIN LAYER----
,
 JOIN_MSCN as ( SELECT * 
			from  FILTER_MSCN )
 SELECT * FROM JOIN_MSCN