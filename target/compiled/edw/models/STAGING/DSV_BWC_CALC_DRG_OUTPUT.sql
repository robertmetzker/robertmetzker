
----SRC LAYER----
WITH
SRC_OUTPT as ( SELECT *     from      STAGING.DST_BWC_CALC_DRG_OUTPUT )
----LOGIC LAYER----
,
LOGIC_OUTPT as ( SELECT 
		UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
		TRIM(INVOICE_NUMBER) AS INVOICE_NUMBER,
		DATE_SENT AS DATE_SENT,
		TRIM(DRG_NUMBER) AS DRG_NUMBER,
		TRIM(DRG_TITLE) AS DRG_TITLE,
		TRIM(MAJOR_TITLE) AS MAJOR_TITLE,
		TRIM(MAJOR_CATEGORY) AS MAJOR_CATEGORY,
		TRIM(DIAG_1) AS DIAG_1,
		TRIM(DIAG_1_DESC) AS DIAG_1_DESC,
		TRIM(DIAG_2) AS DIAG_2,
		TRIM(DIAG_2_DESC) AS DIAG_2_DESC,
		TRIM(DIAG_3) AS DIAG_3,
		TRIM(DIAG_3_DESC) AS DIAG_3_DESC,
		TRIM(DIAG_4) AS DIAG_4,
		TRIM(DIAG_4_DESC) AS DIAG_4_DESC,
		TRIM(DIAG_5) AS DIAG_5,
		TRIM(DIAG_5_DESC) AS DIAG_5_DESC,
		TRIM(OR_PROC_1) AS OR_PROC_1,
		TRIM(OR_PROC_1_DESC) AS OR_PROC_1_DESC,
		TRIM(OR_PROC_2) AS OR_PROC_2,
		TRIM(OR_PROC_2_DESC) AS OR_PROC_2_DESC,
		TRIM(OR_PROC_3) AS OR_PROC_3,
		TRIM(OR_PROC_3_DESC) AS OR_PROC_3_DESC,
		TRIM(OR_PROC_4) AS OR_PROC_4,
		TRIM(OR_PROC_4_DESC) AS OR_PROC_4_DESC,
		TRIM(OR_PROC_5) AS OR_PROC_5,
		TRIM(OR_PROC_5_DESC) AS OR_PROC_5_DESC,
		TRIM(NOR_PROC_1) AS NOR_PROC_1,
		TRIM(NOR_PROC_1_DESC) AS NOR_PROC_1_DESC,
		TRIM(NOR_PROC_2) AS NOR_PROC_2,
		TRIM(NOR_PROC_2_DESC) AS NOR_PROC_2_DESC,
		TRIM(NOR_PROC_3) AS NOR_PROC_3,
		TRIM(NOR_PROC_3_DESC) AS NOR_PROC_3_DESC,
		TRIM(NOR_PROC_4) AS NOR_PROC_4,
		TRIM(NOR_PROC_4_DESC) AS NOR_PROC_4_DESC,
		TRIM(NOR_PROC_5) AS NOR_PROC_5,
		TRIM(NOR_PROC_5_DESC) AS NOR_PROC_5_DESC,
		TRIM(RETURN_CODE) AS RETURN_CODE,
		TRIM(RETURN_MSG) AS RETURN_MSG,
		TRIM(RETURN_EXT) AS RETURN_EXT,
		TRIM(GRP_VERSION) AS GRP_VERSION,
		TRIM(GRP_METHOD) AS GRP_METHOD,
		TRIM(PRC_VERSION) AS PRC_VERSION 
				from SRC_OUTPT
            )
----RENAME LAYER ----
,
RENAME_OUTPT as ( SELECT UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
			
			INVOICE_NUMBER AS MEDICAL_INVOICE_NUMBER,DATE_SENT AS DATE_SENT,
			
			DRG_NUMBER AS DIAGNOSIS_RELATED_GROUP_CODE,
			
			DRG_TITLE AS DIAGNOSIS_RELATED_GROUP_TITLE,MAJOR_TITLE AS MAJOR_TITLE,MAJOR_CATEGORY AS MAJOR_CATEGORY,
			
			DIAG_1 AS DIAGNOSIS_CODE_1,
			
			DIAG_1_DESC AS DIAGNOSIS_DESC_1,
			
			DIAG_2 AS DIAGNOSIS_CODE_2,
			
			DIAG_2_DESC AS DIAGNOSIS_DESC_2,
			
			DIAG_3 AS DIAGNOSIS_CODE_3,
			
			DIAG_3_DESC AS DIAGNOSIS_DESC_3,
			
			DIAG_4 AS DIAGNOSIS_CODE_4,
			
			DIAG_4_DESC AS DIAGNOSIS_DESC_4,
			
			DIAG_5 AS DIAGNOSIS_CODE_5,
			
			DIAG_5_DESC AS DIAGNOSIS_DESC_5,
			
			OR_PROC_1 AS OR_PROCEDURE_CODE_1,
			
			OR_PROC_1_DESC AS OR_PROCEDURE_DESC_1,
			
			OR_PROC_2 AS OR_PROCEDURE_CODE_2,
			
			OR_PROC_2_DESC AS OR_PROCEDURE_DESC_2,
			
			OR_PROC_3 AS OR_PROCEDURE_CODE_3,
			
			OR_PROC_3_DESC AS OR_PROCEDURE_DESC_3,
			
			OR_PROC_4 AS OR_PROCEDURE_CODE_4,
			
			OR_PROC_4_DESC AS OR_PROCEDURE_DESC_4,
			
			OR_PROC_5 AS OR_PROCEDURE_CODE_5,
			
			OR_PROC_5_DESC AS OR_PROCEDURE_DESC_5,
			
			NOR_PROC_1 AS NON_OR_PROCEDURE_CODE_1,
			
			NOR_PROC_1_DESC AS NON_OR_PROCEDURE_DESC_1,
			
			NOR_PROC_2 AS NON_OR_PROCEDURE_CODE_2,
			
			NOR_PROC_2_DESC AS NON_OR_PROCEDURE_DESC_2,
			
			NOR_PROC_3 AS NON_OR_PROCEDURE_CODE_3,
			
			NOR_PROC_3_DESC AS NON_OR_PROCEDURE_DESC_3,
			
			NOR_PROC_4 AS NON_OR_PROCEDURE_CODE_4,
			
			NOR_PROC_4_DESC AS NON_OR_PROCEDURE_DESC_4,
			
			NOR_PROC_5 AS NON_OR_PROCEDURE_CODE_5,
			
			NOR_PROC_5_DESC AS NON_OR_PROCEDURE_DESC_5,RETURN_CODE AS RETURN_CODE,
			
			RETURN_MSG AS RETURN_MESSAGE,
			
			RETURN_EXT AS RETURN_EXTENSION,
			
			GRP_VERSION AS GROUPER_VERSION,
			
			GRP_METHOD AS GROUPER_METHOD,
			
			PRC_VERSION AS PRICER_VERSION 
			from      LOGIC_OUTPT
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_OUTPT as ( SELECT  * 
			from     RENAME_OUTPT 
            
        )
----JOIN LAYER----
,
 JOIN_OUTPT as ( SELECT * 
			from  FILTER_OUTPT )
 SELECT * FROM JOIN_OUTPT