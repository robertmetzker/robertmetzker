----SRC LAYER----
WITH
SRC_APC as ( SELECT *     from      DEV_VIEWS.BASE.INVOICE_LINE_APC )
//SRC_APC as ( SELECT *     from      INVOICE_LINE_APC)
----LOGIC LAYER----
,
LOGIC_APC as ( SELECT 
		INVOICE_LINE_ID AS INVOICE_LINE_ID,
		UPPER(TRIM(STATUS)) AS STATUS,
		UPPER(TRIM(APC_CODE)) AS APC_CODE,
		BASE_AMOUNT AS BASE_AMOUNT,
		OUTLIER AS OUTLIER,
		RURAL AS RURAL,
		HOLD_HARMLESS AS HOLD_HARMLESS,
		MEDICARE_AMOUNT AS MEDICARE_AMOUNT,
		MARKUP AS MARKUP,
		CALC_TOTAL AS CALC_TOTAL,
		UPPER(TRIM(DISCOUNT)) AS DISCOUNT,
		FINAL_MARKUP AS FINAL_MARKUP,
		UPPER(TRIM(COMPOSITE_ADJUSTMENT)) AS COMPOSITE_ADJUSTMENT,
		UPPER(TRIM(NON_OPPS_BILL_TYPE)) AS NON_OPPS_BILL_TYPE,
		UPPER(TRIM(OPPS_FLAG)) AS OPPS_FLAG,
		UPPER(TRIM(PAYMENT_METHOD)) AS PAYMENT_METHOD,
		SERVICE_UNITS AS SERVICE_UNITS,
		UPPER(TRIM(PACKAGING)) AS PACKAGING,
		UPPER(TRIM(PAYMENT_ADJUSTMENT)) AS PAYMENT_ADJUSTMENT,
		UPPER(TRIM(PAYMENT_INDICATOR)) AS PAYMENT_INDICATOR 
				from SRC_APC
            )
----RENAME LAYER ----
,
RENAME_APC as ( SELECT INVOICE_LINE_ID AS INVOICE_LINE_ID,STATUS AS STATUS,APC_CODE AS APC_CODE,BASE_AMOUNT AS BASE_AMOUNT,OUTLIER AS OUTLIER,RURAL AS RURAL,HOLD_HARMLESS AS HOLD_HARMLESS,MEDICARE_AMOUNT AS MEDICARE_AMOUNT,MARKUP AS MARKUP,CALC_TOTAL AS CALC_TOTAL,DISCOUNT AS DISCOUNT,FINAL_MARKUP AS FINAL_MARKUP,COMPOSITE_ADJUSTMENT AS COMPOSITE_ADJUSTMENT,NON_OPPS_BILL_TYPE AS NON_OPPS_BILL_TYPE,OPPS_FLAG AS OPPS_FLAG,PAYMENT_METHOD AS PAYMENT_METHOD,SERVICE_UNITS AS SERVICE_UNITS,PACKAGING AS PACKAGING,PAYMENT_ADJUSTMENT AS PAYMENT_ADJUSTMENT,PAYMENT_INDICATOR AS PAYMENT_INDICATOR 
			from      LOGIC_APC
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_APC as ( SELECT  * 
			from     RENAME_APC 
            
        )
----JOIN LAYER----
,
 JOIN_APC as ( SELECT * 
			from  FILTER_APC )
 SELECT * FROM JOIN_APC