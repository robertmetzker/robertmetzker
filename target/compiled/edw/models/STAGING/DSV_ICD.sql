

----SRC LAYER----
WITH
SRC_ICD as ( SELECT *     from      STAGING.DST_ICD )
//SRC_ICD as ( SELECT *     from      DST_ICD)
----LOGIC LAYER----
,
LOGIC_ICD as ( SELECT 
		UNIQUE_ID_KEY AS UNIQUE_ID_KEY,
		ICD_CODE AS ICD_CODE,
		ICD_DESC AS ICD_DESC,
		ICD_LONG_DESC AS ICD_LONG_DESC,
		ICD_STATUS_CODE AS ICD_STATUS_CODE,
		ICD_STATUS_DESC AS ICD_STATUS_DESC,
		ICD_STATUS_EFFECTIVE_DATE AS ICD_STATUS_EFFECTIVE_DATE,
		ICD_STATUS_END_DATE AS ICD_STATUS_END_DATE,
		ICD_CODE_VERSION_NUMBER AS ICD_CODE_VERSION_NUMBER,
		GENDER_TYPE_CODE AS GENDER_TYPE_CODE,
		GENDER_TYPE_NAME AS GENDER_TYPE_NAME,
		AUTHORIZED_FOR_BILLING_USE_IND AS AUTHORIZED_FOR_BILLING_USE_IND,
		AUTHORIZED_FOR_CLAIM_USE_IND AS AUTHORIZED_FOR_CLAIM_USE_IND,
		CATASTROPHIC_ICD_IND AS CATASTROPHIC_ICD_IND,
		ICD_CMS_PROHIBITED_IND AS ICD_CMS_PROHIBITED_IND,
		ICD_ASGN_TO_FLD_REQD_IND AS ICD_ASGN_TO_FLD_REQD_IND,
		ICD_ACP_ELIG_IND AS ICD_ACP_ELIG_IND,
		ENCODER_VALIDATION_IND AS ENCODER_VALIDATION_IND,
		ICD_PRIVACY_IND AS ICD_PRIVACY_IND,
		ICD_STAT_OD_IND AS ICD_STAT_OD_IND,
		LOCATION_REQUIRED_IND AS LOCATION_REQUIRED_IND,
		PRIOR_AUTHORIZATION_IND AS PRIOR_AUTHORIZATION_IND,
		CRNT_PSC_IND AS CRNT_PSC_IND,
		PSYCHOLOGICAL_ICD_IND AS PSYCHOLOGICAL_ICD_IND,
		ICD_SEC_AUTH_REQ_IND AS ICD_SEC_AUTH_REQ_IND,
		SITE_REQUIRED_IND AS SITE_REQUIRED_IND,
		SUBROGATION_REVIEW_IND AS SUBROGATION_REVIEW_IND,
		EM_REFERRAL_SAFETY_DISCIPLINE_CODE AS EM_REFERRAL_SAFETY_DISCIPLINE_CODE,
		EM_REFERRAL_SAFETY_DISCIPLINE_DESC AS EM_REFERRAL_SAFETY_DISCIPLINE_DESC,
		ICD_CHAPTER_NUMBER AS ICD_CHAPTER_NUMBER,
		ICD_SHORT_CHAPTER_DEC AS ICD_SHORT_CHAPTER_DEC,
		ICD_FULL_CHAPTER_DESC AS ICD_FULL_CHAPTER_DESC,
		INJURY_CLASS_DESC AS INJURY_CLASS_DESC,
		ICD_SPECIFIC_BODY_PART_DESC AS ICD_SPECIFIC_BODY_PART_DESC,
		ICD_GENERAL_BODY_PART_DESC AS ICD_GENERAL_BODY_PART_DESC 
				from SRC_ICD
            )
----RENAME LAYER ----
,
RENAME_ICD as ( SELECT UNIQUE_ID_KEY AS UNIQUE_ID_KEY,ICD_CODE AS ICD_CODE,
			
			ICD_DESC AS ICD_CODE_SHORT_DESC,
			
			ICD_LONG_DESC AS ICD_CODE_LONG_DESC,
			
			ICD_STATUS_CODE AS ICD_CODE_STATUS_CODE,
			
			ICD_STATUS_DESC AS ICD_CODE_STATUS_DESC,
			
			ICD_STATUS_EFFECTIVE_DATE AS ICD_CODE_STATUS_EFFECTIVE_DATE,
			
			ICD_STATUS_END_DATE AS ICD_CODE_STATUS_END_DATE,ICD_CODE_VERSION_NUMBER AS ICD_CODE_VERSION_NUMBER,
			
			GENDER_TYPE_CODE AS GENDER_SPECIFIC_CODE,
			
			GENDER_TYPE_NAME AS GENDER_SPECIFIC_DESC,
			
			AUTHORIZED_FOR_BILLING_USE_IND AS AUTHORIZED_BILL_USE_IND,
			
			AUTHORIZED_FOR_CLAIM_USE_IND AS AUTHORIZED_CLAIM_USE_IND,CATASTROPHIC_ICD_IND AS CATASTROPHIC_ICD_IND,
			
			ICD_CMS_PROHIBITED_IND AS CMS_PROHIBITED_IND,
			
			ICD_ASGN_TO_FLD_REQD_IND AS ASSIGN_ICD_TO_FIELD_IND,
			
			ICD_ACP_ELIG_IND AS ICD_ACP_ELIGIBILE_IND,
			
			ENCODER_VALIDATION_IND AS ENCODER_VALIDATION_REQUIRED_IND,ICD_PRIVACY_IND AS ICD_PRIVACY_IND,
			
			ICD_STAT_OD_IND AS ICD_STATUTORY_OCCUPATIONAL_DISEASE_IND,
			
			LOCATION_REQUIRED_IND AS ICD_LOCATION_REQUIRED_IND,
			
			PRIOR_AUTHORIZATION_IND AS ICD_PRIOR_AUTHORIZATION_REQUIRED_IND,
			
			CRNT_PSC_IND AS ICD_POTENTIAL_SEVERE_COMPLICATIONS_IND,
			
			PSYCHOLOGICAL_ICD_IND AS ICD_PSYCHOLOGICAL_IND,
			
			ICD_SEC_AUTH_REQ_IND AS ICD_SECURITY_AUTHORIZATION_IND,
			
			SITE_REQUIRED_IND AS ICD_SITE_REQUIRED_IND,
			
			SUBROGATION_REVIEW_IND AS ICD_SUBROGATION_REVIEW_IND,
			
			EM_REFERRAL_SAFETY_DISCIPLINE_CODE AS EM_REFERRAL_CODE,
			
			EM_REFERRAL_SAFETY_DISCIPLINE_DESC AS EM_REFERRAL_DESC,
			
			ICD_CHAPTER_NUMBER AS ICD_CODE_CHAPTER_NUMBER,
			
			ICD_SHORT_CHAPTER_DEC AS ICD_CODE_CHAPTER_NUMBER_SHORT_DESC,
			
			ICD_FULL_CHAPTER_DESC AS ICD_CODE_CHAPTER_NUMBER_LONG_DESC,
			
			INJURY_CLASS_DESC AS BWC_INJURY_CLASS_DESC,
			
			ICD_SPECIFIC_BODY_PART_DESC AS BWC_SPECIFIC_BODY_PART_DESC,
			
			ICD_GENERAL_BODY_PART_DESC AS BWC_GENERIC_BODY_PART_DESC 
			from      LOGIC_ICD
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_ICD as ( SELECT  * 
			from     RENAME_ICD 
            
        )
----JOIN LAYER----
,
 JOIN_ICD as ( SELECT * 
			from  FILTER_ICD )
 SELECT * FROM JOIN_ICD