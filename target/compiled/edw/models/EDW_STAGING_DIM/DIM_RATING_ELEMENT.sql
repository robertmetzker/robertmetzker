

 WITH  SCD AS ( 
	SELECT  UNIQUE_ID_KEY,
     last_value(RATE_ELEMENT_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as RATE_ELEMENT_TYPE_CODE, 
     last_value(RATE_ELEMENT_USAGE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as RATE_ELEMENT_USAGE_CODE, 
     last_value(RATE_ELEMENT_TYPE_DESC) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as RATE_ELEMENT_TYPE_DESC, 
     last_value(RATE_ELEMENT_USAGE_DESC) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as RATE_ELEMENT_USAGE_DESC

     
	FROM EDW_STAGING.DIM_RATING_ELEMENT_SCDALL_STEP2)

select 
 UNIQUE_ID_KEY AS RATING_ELEMENT_HKEY
,UNIQUE_ID_KEY
,RATE_ELEMENT_TYPE_CODE
,RATE_ELEMENT_USAGE_CODE
,RATE_ELEMENT_TYPE_DESC
,RATE_ELEMENT_USAGE_DESC
, CURRENT_TIMESTAMP AS LOAD_DATETIME
, try_to_TIMESTAMP('Invalid')  AS UPDATE_DATETIME
, 'CORESUITE' AS PRIMARY_SOURCE_SYSTEM

 from SCD