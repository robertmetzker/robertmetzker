

 WITH  SCD AS ( 
	SELECT  UNIQUE_ID_KEY,
     last_value(DISABILITY_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_TYPE_CODE, 
     last_value(DISABILITY_REASON_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_REASON_TYPE_CODE, 
     last_value(DISABILITY_MEDICAL_STATUS_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_MEDICAL_STATUS_TYPE_CODE, 
     last_value(DISABILITY_WORK_STATUS_TYPE_CODE) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_WORK_STATUS_TYPE_CODE, 
	CURRENT_DISABILITY_STATUS_IND,
     last_value(DISABILITY_TYPE_NAME) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_TYPE_NAME, 
     last_value(DISABILITY_MANAGEMENT_REASON_TYPE_NAME) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_MANAGEMENT_REASON_TYPE_NAME, 
     last_value(DISABILITY_MEDICAL_STATUS_TYPE_NAME) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_MEDICAL_STATUS_TYPE_NAME, 
     last_value(DISABILITY_WORK_STATUS_TYPE_NAME) over 
        (partition by UNIQUE_ID_KEY 
        order by UNIQUE_ID_KEY 
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
            ) as DISABILITY_WORK_STATUS_TYPE_NAME

	FROM EDW_STAGING.DIM_DISABILITY_TYPE_SCDALL_STEP2),

------------- ETL LAYER -----------
ETL AS (select 
   UNIQUE_ID_KEY as DISABILITY_TYPE_HKEY
 , UNIQUE_ID_KEY
 , DISABILITY_TYPE_CODE
 , DISABILITY_REASON_TYPE_CODE
 , DISABILITY_MEDICAL_STATUS_TYPE_CODE
 , DISABILITY_WORK_STATUS_TYPE_CODE
 , CURRENT_DISABILITY_STATUS_IND
 , DISABILITY_TYPE_NAME
 , DISABILITY_MANAGEMENT_REASON_TYPE_NAME
 , DISABILITY_MEDICAL_STATUS_TYPE_NAME
 , DISABILITY_WORK_STATUS_TYPE_NAME
 , CURRENT_TIMESTAMP AS LOAD_DATETIME
 , try_to_TIMESTAMP('Invalid')  AS UPDATE_DATETIME
 , 'CORESUITE' AS PRIMARY_SOURCE_SYSTEM
 from SCD)
SELECT * FROM ETL