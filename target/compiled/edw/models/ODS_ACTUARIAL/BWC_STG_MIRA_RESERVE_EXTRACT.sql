----SRC LAYER----
WITH
SRC_A as ( SELECT *     from       STAGING.STG_MIRA_VALIDATION_EXTRACT ),
SRC_B as ( SELECT *     from       STAGING.STG_MIRA_STOP_CONDITIONS )
//SRC_A as ( SELECT *     from      STG_MIRA_VALIDATION_EXTRACT),
//SRC_B as ( SELECT *     from      STG_MIRA_STOP_CONDITIONS)
----LOGIC LAYER----
,
LOGIC_A as ( SELECT 
		EXTRC_DATE AS EXTRC_DATE,
		CLAIM_NUMBER AS CLAIM_NUMBER,
		INJURY_DATE AS INJURY_DATE,
		INJURY_YEAR AS INJURY_YEAR,
		WCIS_POLICY_NUMBER AS WCIS_POLICY_NUMBER,
        MANUAL AS MANUAL,
		LAST_PREDICTION_STATUS AS LAST_PREDICTION_STATUS,
		INJURY_TYPE AS INJURY_TYPE,
		EMPLOYER_TYPE AS EMPLOYER_TYPE,
		COVERAGE_TYPE AS COVERAGE_TYPE,
		PRIMARY_ICD AS PRIMARY_ICD,
		LAST_MED_PAY_DATE AS LAST_MED_PAY_DATE,
		LAST_PREDICTION_DATE AS LAST_PREDICTION_DATE,
        LAST_COMP_STOP_DATE AS LAST_COMP_STOP_DATE,
        LAST_LM_STOP_DATE AS LAST_LM_STOP_DATE,
        CLAIM_CATEGORY AS CLAIM_CATEGORY,
		TOTAL_INCURRED AS TOTAL_INCURRED,
		TOTAL_PAID AS TOTAL_PAID,
		TOTAL_ORIGINAL_RESERVE AS TOTAL_ORIGINAL_RESERVE,
		TOTAL_ADJUSTED_RESERVE AS TOTAL_ADJUSTED_RESERVE,
		TOTAL_PUBLISHED_RESERVE AS TOTAL_PUBLISHED_RESERVE,
		TOTAL_INDEMNITY_PAID AS TOTAL_INDEMNITY_PAID,
		DTH_INCURRED AS DTH_INCURRED,
		DTH_PAID AS DTH_PAID,
		DTH_ORIGINAL_RESERVE AS DTH_ORIGINAL_RESERVE,
		DTH_ADJUSTED_RESERVE AS DTH_ADJUSTED_RESERVE,
		DTH_PREDICTION_FLAG AS DTH_PREDICTION_FLAG,
		LM_INCURRED AS LM_INCURRED,
		LM_PAID AS LM_PAID,
        LSS_AMOUNT AS LSS_AMOUNT,
		LM_ORIGINAL_RESERVE AS LM_ORIGINAL_RESERVE,
		LM_ADJUSTED_RESERVE AS LM_ADJUSTED_RESERVE,
		LM_PREDICTION_FLAG AS LM_PREDICTION_FLAG,
		MED_INCURRED AS MED_INCURRED,
		MED_PAID AS MED_PAID,
		MED_ORIGINAL_RESERVE AS MED_ORIGINAL_RESERVE,
		MED_ADJUSTED_RESERVE AS MED_ADJUSTED_RESERVE,
		MED_PREDICTION_FLAG AS MED_PREDICTION_FLAG,
		PT_INCURRED AS PT_INCURRED,
		PT_PAID AS PT_PAID,
		PT_ORIGINAL_RESERVE AS PT_ORIGINAL_RESERVE,
		PT_ADJUSTED_RESERVE AS PT_ADJUSTED_RESERVE,
		PT_PREDICTION_FLAG AS PT_PREDICTION_FLAG,
		FD_INCURRED AS FD_INCURRED,
		FD_PAID AS FD_PAID,
		FD_ORIGINAL_RESERVE AS FD_ORIGINAL_RESERVE,
		FD_ADJUSTED_RESERVE AS FD_ADJUSTED_RESERVE,
		FD_PREDICTION_FLAG AS FD_PREDICTION_FLAG,
		CO_INCURRED AS CO_INCURRED,
		CO_PAID AS CO_PAID,
		CO_ORIGINAL_RESERVE AS CO_ORIGINAL_RESERVE,
		CO_ADJUSTED_RESERVE AS CO_ADJUSTED_RESERVE,
		CO_PREDICTION_FLAG AS CO_PREDICTION_FLAG,
		PPG_INCURRED AS PPG_INCURRED,
		PPG_PAID AS PPG_PAID,
		PPG_ORIGINAL_RESERVE AS PPG_ORIGINAL_RESERVE,
		PPG_ADJUSTED_RESERVE AS PPG_ADJUSTED_RESERVE,
		TG_INCURRED AS TG_INCURRED,
		TG_PAID AS TG_PAID,
		TG_ORIGINAL_RESERVE AS TG_ORIGINAL_RESERVE,
		TG_ADJUSTED_RESERVE AS TG_ADJUSTED_RESERVE,
		TG_PREDICTION_FLAG AS TG_PREDICTION_FLAG,
		OIG_INCURRED AS OIG_INCURRED,
		OIG_PAID AS OIG_PAID,
		OIG_ORIGINAL_RESERVE AS OIG_ORIGINAL_RESERVE,
		OIG_ADJUSTED_RESERVE AS OIG_ADJUSTED_RESERVE,
		SC_TOTAL AS SC_TOTAL,
		SC_ONLY_REDUCTION AS SC_ONLY_REDUCTION,
		SC_AND_LM_ONLY_REDUCTION AS SC_AND_LM_ONLY_REDUCTION,
		SC_AND_OTHER_INDEMNITY_REDUCTION AS SC_AND_OTHER_INDEMNITY_REDUCTION,
		MO_REDUCTION AS MO_REDUCTION,
		LMWL_REDUCTION AS LMWL_REDUCTION
				from SRC_A
            ),
LOGIC_B as ( SELECT 
		ACCIDENT_TYPE AS ACCIDENT_TYPE,
		PD_STS_CODE AS PD_STS_CODE,
		CLAIM_STATUS_CODE AS CLAIM_STATUS_CODE,
		CLSC_NMBR AS CLSC_NMBR,
		ACCIDENT_RSLT_IN_DEATH AS ACCIDENT_RSLT_IN_DEATH,
		INACTIVE_STATUS AS INACTIVE_STATUS,
		OPEN_CLOSE_IND AS OPEN_CLOSE_IND,
		C92_CODE AS C92_CODE,
		C92_EFFECTIVE AS C92_EFFECTIVE,
		C92_END_DATE AS C92_END_DATE,
		CO_PAID_WEEKS AS CO_PAID_WEEKS,
		FILING_DATE AS FILING_DATE,
		EST_RTW_DATE AS EST_RTW_DATE,
		RTW_DATE AS RTW_DATE,
		DEATH_DATE AS DEATH_DATE,
		REHAB_DATE AS REHAB_DATE,
		MMI_DATE AS MMI_DATE,
		CLAIM_STATUS_DATE AS CLAIM_STATUS_DATE,
		LAST_COMP_PAY_DATE AS LAST_COMP_PAY_DATE,
		TTL_INDEM_PAID AS TTL_INDEM_PAID,
		LAST_DEP_BNFT_TERM_DATE AS LAST_DEP_BNFT_TERM_DATE,
		LAST_DEATH_PAY_DATE AS LAST_DEATH_PAY_DATE,
		LAST_DEATH_STOP_DATE AS LAST_DEATH_STOP_DATE,
		LAST_LM_PAY_DATE AS LAST_LM_PAY_DATE,
		LAST_PREDICTION AS LAST_PREDICTION,
		LAST_FD_PAY_DATE AS LAST_FD_PAY_DATE,
		LAST_FD_STOP_DATE AS LAST_FD_STOP_DATE,
		LAST_PP_STOP_DATE AS LAST_PP_STOP_DATE,
		LAST_PPD_PAY_DATE AS LAST_PPD_PAY_DATE,
		LAST_CO_STOP_DATE AS LAST_CO_STOP_DATE,
		LAST_WL_STOP_DATE AS LAST_WL_STOP_DATE,
		LAST_TT_PAY_DATE AS LAST_TT_PAY_DATE,
		LAST_TT_STOP_DATE AS LAST_TT_STOP_DATE,
		LAST_TP_STOP_DATE AS LAST_TP_STOP_DATE,
		LAST_MEDICAL_SERVICE_DATE AS LAST_MEDICAL_SERVICE_DATE,
		PP_PAID_AMT AS PP_PAID_AMT,
		DEPENDENTS_QTY AS DEPENDENTS_QTY,
		EXTRC_DATE AS EXTRC_DATE,
		MANUAL_CLASS_BASE_CODE AS MANUAL_CLASS_BASE_CODE,
		CLAIM_CATEGORY AS CLAIM_CATEGORY,
		LAST_COMP_STOP_DATE AS LAST_COMP_STOP_DATE,
		LAST_LM_STOP_DATE AS LAST_LM_STOP_DATE,
		LAST_MED_PAY_DATE AS LAST_MED_PAY_DATE,
		DEATH_PAID_AMT AS DEATH_PAID_AMT,
		TTL_MED_PAID_AMT AS TTL_MED_PAID_AMT,
		LSS_AMOUNT AS LSS_AMOUNT 
				from SRC_B
            )
----RENAME LAYER ----
,
RENAME_A as ( SELECT 
			
			EXTRC_DATE AS EXTRACT_DATE,
			
			EXTRC_DATE AS QRTR_YEAR,
			
			CLAIM_NUMBER AS CLAIM_NMBR,
			
			INJURY_DATE AS INJRY_DATE,
			
			INJURY_YEAR AS INJRY_YEAR,
			
			WCIS_POLICY_NUMBER AS PLCY_NMBR,

            MANUAL AS MANUAL_CLASS_CODE,
			
			LAST_PREDICTION_STATUS AS PRDCT_STS_CODE,
			
			INJURY_TYPE AS INJRY_TYPE_CODE,
			
			EMPLOYER_TYPE AS EMPLY_TYPE_CODE,
			
			COVERAGE_TYPE AS CVRG_TYPE_CODE,

            CLAIM_CATEGORY AS CLAIM_CATEGORY,
			
			PRIMARY_ICD AS PRMRY_ICD_CODE,
						
		    LAST_MED_PAY_DATE AS LAST_MED_PAY_DATE,
			
			LAST_PREDICTION_DATE AS LAST_PREDICTION_DATE,
            
            LAST_COMP_STOP_DATE AS LAST_COMP_STOP_DATE,
                
            LAST_LM_STOP_DATE AS LAST_LM_STOP_DATE,
			
			TOTAL_INCURRED AS TOTAL_INCRD_AMT,
			
			TOTAL_PAID AS TOTAL_PAID_AMT,
			
			TOTAL_ORIGINAL_RESERVE AS TOTAL_ORGNL_RSRV_AMT,
			
			TOTAL_ADJUSTED_RESERVE AS TOTAL_ADJST_RSRV_AMNT,
			
			TOTAL_PUBLISHED_RESERVE AS TOTAL_PBLSH_RSRV_AMT,
			
			TOTAL_INDEMNITY_PAID AS TOTAL_INDEMNITY_PAID,
			
			DTH_INCURRED AS DTH_BNFT_INCRD_AMT,
			
			DTH_PAID AS DTH_PAID,
			
			DTH_ORIGINAL_RESERVE AS DTH_BNFT_ORGNL_RSRV_AMT,
			
			DTH_ADJUSTED_RESERVE AS DTH_BNFT_ADJST_RSRV_AMNT,
			
			DTH_PREDICTION_FLAG AS DTH_BNFT_PRDCT_IND,
			
			LM_INCURRED AS LM_INCRD_AMT,
			
			LM_PAID AS LM_PAID_AMT,
             
            LSS_AMOUNT AS LSS_AMOUNT,
			
			LM_ORIGINAL_RESERVE AS LM_ORGNL_RSRV_AMT,
			
			LM_ADJUSTED_RESERVE AS LM_ADJST_RSRV_AMNT,
			
			LM_PREDICTION_FLAG AS LM_PRDCT_IND,
			
			MED_INCURRED AS MDCL_INCRD_AMT,
			
			MED_PAID AS MED_PAID,
			
			MED_ORIGINAL_RESERVE AS MDCL_ORGNL_RSRV_AMT,
			
			MED_ADJUSTED_RESERVE AS MDCL_ADJST_RSRV_AMNT,
			
			MED_PREDICTION_FLAG AS MDCL_PRDCT_IND,
			
			PT_INCURRED AS PT_INCRD_AMT,
			
			PT_PAID AS PT_PAID_AMT,
			
			PT_ORIGINAL_RESERVE AS PT_ORGNL_RSRV_AMT,
			
			PT_ADJUSTED_RESERVE AS PT_ADJST_RSRV_AMNT,
			
			PT_PREDICTION_FLAG AS PT_PRDCT_IND,
			
			FD_INCURRED AS FD_INCRD_AMT,
			
			FD_PAID AS FD_PAID_AMT,
			
			FD_ORIGINAL_RESERVE AS FD_ORGNL_RSRV_AMT,
			
			FD_ADJUSTED_RESERVE AS FD_ADJST_RSRV_AMNT,
			
			FD_PREDICTION_FLAG AS FD_PRDCT_IND,
			
			CO_INCURRED AS CO_INCRD_AMT,
			
			CO_PAID AS CO_PAID_AMT,
			
			CO_ORIGINAL_RESERVE AS CO_ORGNL_RSRV_AMT,
			
			CO_ADJUSTED_RESERVE AS CO_ADJST_RSRV_AMNT,
			
			CO_PREDICTION_FLAG AS CO_PRDCT_IND,
			
			PPG_INCURRED AS SUM_PP_PRCNT_PP_INCRD_AMT,
			
			PPG_PAID AS SUM_PP_PRCNT_PP_PAID_AMT,
			
			PPG_ORIGINAL_RESERVE AS SUM_PP_PRCNT_PP_ORGNL_RSRV_AMT,
			
			PPG_ADJUSTED_RESERVE AS SUM_PP_PRCNT_PP_ADJST_RSRV_AMNT,
						
			TG_INCURRED AS SUM_TP_TT_WG_INCRD_AMT,
			
			TG_PAID AS SUM_TP_TT_WG_PAID_AMT,
			
			TG_ORIGINAL_RESERVE AS SUM_TP_TT_WG_ORGNL_RSRV_AMT,
			
			TG_ADJUSTED_RESERVE AS SUM_TP_TT_WG_ADJST_RSRV_AMNT,
			
			TG_PREDICTION_FLAG AS TP_TT_WL_PRDCT_IND,
			
			OIG_INCURRED AS OIG_INCRD_AMT,
			
			OIG_PAID AS OIG_PAID_AMT,
			
			OIG_ORIGINAL_RESERVE AS OIG_ORGNL_RSRV_AMT,
			
			OIG_ADJUSTED_RESERVE AS OIG_ADJST_RSRV_AMNT,
			
			SC_TOTAL AS SLRY_CNTNT_AMT,
			
			SC_ONLY_REDUCTION AS SLRY_CNTNT_RDCTN_AMT,
			
			SC_AND_LM_ONLY_REDUCTION AS SLRY_CNTNT_LM_RDCTN_AMT,
			
			SC_AND_OTHER_INDEMNITY_REDUCTION AS SLRY_CNTNT_OTH_LM_RDCTN_AMT,
			
			MO_REDUCTION AS MDCL_RDCTN_AMT,
			
			LMWL_REDUCTION AS LM_LMWL_RDCTN_AMT

			from      LOGIC_A
        ),
RENAME_B as ( SELECT 
			
			ACCIDENT_TYPE AS ACDNT_TYPE_CODE,
			
			PD_STS_CODE AS INJRY_SVRTY_CODE,
			
			CLAIM_STATUS_CODE AS CLAIM_STS_CODE,
			
			CLSC_NMBR AS STOP_CNDTN_IND,
			
			ACCIDENT_RSLT_IN_DEATH AS FATAL_INJRY_IND,
			
			INACTIVE_STATUS AS CLAIM_INCTV_IND,
			
			OPEN_CLOSE_IND AS CLAIM_CLSD_IND,
			
			C92_CODE AS C92_APLCT_STS_CODE,
			
			C92_EFFECTIVE AS C92_APLCT_ALWD_DATE,
			
			C92_END_DATE AS C92_APLCT_DSLWD_DATE,
			
			CO_PAID_WEEKS AS CO_PAID_WEEK_QTY,
			
			FILING_DATE AS FLNG_DATE,
			
			EST_RTW_DATE AS ESTMT_RTW_DATE,RTW_DATE AS RTW_DATE,
			
			DEATH_DATE AS DTH_DATE,
			
			REHAB_DATE AS REHAB_START_DATE,MMI_DATE AS MMI_DATE,
			
			CLAIM_STATUS_DATE AS CLAIM_FIRST_DCSN_DATE,
			
			LAST_COMP_PAY_DATE AS LAST_CMPNS_PAID_DATE,
			
			TTL_INDEM_PAID AS TTL_INDEM_PAID,
			
			LAST_DEP_BNFT_TERM_DATE AS LAST_DPNDN_BNFT_PAID_DATE,
			
			LAST_DEATH_PAY_DATE AS LAST_DTH_BNFT_PAY_DATE,
			
			LAST_DEATH_STOP_DATE AS LAST_DTH_BNFT_STOP_DATE,
			
			LAST_LM_PAY_DATE AS LAST_LM_PAID_DATE,
						
			LAST_FD_PAY_DATE AS LAST_FD_PAID_DATE,LAST_FD_STOP_DATE AS LAST_FD_STOP_DATE,LAST_PP_STOP_DATE AS LAST_PP_STOP_DATE,
			
			LAST_PPD_PAY_DATE AS LAST_PRCNT_PP_PAID_DATE,LAST_CO_STOP_DATE AS LAST_CO_STOP_DATE,LAST_WL_STOP_DATE AS LAST_WL_STOP_DATE,
			
			LAST_TT_PAY_DATE AS LAST_TT_PAID_DATE,LAST_TT_STOP_DATE AS LAST_TT_STOP_DATE,LAST_TP_STOP_DATE AS LAST_TP_STOP_DATE,
			
			LAST_MEDICAL_SERVICE_DATE AS LAST_MDCL_SRVC_DATE,
			
			PP_PAID_AMT AS PP_PAID_AMT,
			
			DEPENDENTS_QTY AS DEPENDENTS_QTY,
			
			EXTRC_DATE AS B_EXTRC_DATE,CLSC_NMBR AS CLSC_NMBR,MANUAL_CLASS_BASE_CODE AS MANUAL_CLASS_BASE_CODE,
			
			CLAIM_CATEGORY AS B_Claim_Category,
			
			LAST_COMP_STOP_DATE AS B_LAST_COMP_STOP_DATE,
			
			LAST_LM_STOP_DATE AS B_LAST_LM_STOP_DATE,
			
			LAST_MED_PAY_DATE AS B_LAST_MED_PAY_DATE,LAST_PREDICTION AS LAST_PREDICTION,DEATH_PAID_AMT AS DEATH_PAID_AMT,TTL_MED_PAID_AMT AS TTL_MED_PAID_AMT,
			
			LSS_AMOUNT AS B_LSS_AMOUNT 
			from      LOGIC_B
        )
----FILTER LAYER(uses aliases)----
,

        FILTER_A as ( SELECT  * 
			from     RENAME_A 
            
        ),

        FILTER_B as ( SELECT  * 
			from     RENAME_B 
            
        )
----JOIN LAYER----
,
A as ( SELECT * 
			from  FILTER_A
				LEFT JOIN FILTER_B ON FILTER_A.CLAIM_NMBR = FILTER_B.CLSC_NMBR AND FILTER_A.EXTRACT_DATE = FILTER_B.B_EXTRC_DATE)
-- ETL LAYER--

SELECT 
md5(cast(
    
    coalesce(cast(CLAIM_NMBR as 
    varchar
), '') || '-' || coalesce(cast(EXTRACT_DATE as 
    varchar
), '')

 as 
    varchar
)) as UNIQUE_ID_KEY
, EXTRACT_DATE
, YEAR(EXTRACT_DATE)-2 ||'-Q'|| QUARTER(EXTRACT_DATE)::varchar(15) as QRTR_YEAR
, CLAIM_NMBR
, INJRY_DATE AS INJRY_DATE
, INJRY_YEAR AS INJRY_YEAR
, LPAD(PLCY_NMBR,8,'0')  AS PLCY_NMBR
, LPAD(NULLIF(COALESCE(MANUAL_CLASS_CODE,MANUAL_CLASS_BASE_CODE),''),4,'0') AS MANUAL_CLASS_NMBR               
, PRDCT_STS_CODE
, INJRY_TYPE_CODE
, EMPLY_TYPE_CODE
, CVRG_TYPE_CODE
, CASE (EMPLY_TYPE_CODE||CVRG_TYPE_CODE) WHEN  'PABL' THEN 'BL'
										WHEN  'PASI' THEN 'SI'
										WHEN  'PASF' THEN 'PA'
										WHEN  'PAMF' THEN 'MIF'
										WHEN  'PECPW' THEN 'PEC'
										WHEN  'PECSF' THEN 'PEC'
										WHEN  'PESSF' THEN 'PES'
										ELSE NULL END AS PLCY_TYPE_CODE
, COALESCE(CLAIM_CATEGORY, B_Claim_Category)::VARCHAR(5) AS CLAIM_CTGRY_CODE
, ACDNT_TYPE_CODE AS ACDNT_TYPE_CODE
, INJRY_SVRTY_CODE AS INJRY_SVRTY_CODE
, CLAIM_STS_CODE AS CLAIM_STS_CODE
, PRMRY_ICD_CODE AS PRMRY_ICD_CODE
, (CASE
       WHEN EMPLY_TYPE_CODE IN('PA','PEC') AND CVRG_TYPE_CODE<>'SI' AND TOTAL_ORGNL_RSRV_AMT > '0.00'
       THEN 1  ELSE 0 END)::char(1) AS SELF_INSRD_IND
, (CASE WHEN CLSC_NMBR IS NOT NULL THEN 0 ELSE 1 END)::char(1) AS STOP_CNDTN_IND
, FATAL_INJRY_IND AS FATAL_INJRY_IND
, CLAIM_INCTV_IND AS CLAIM_INCTV_IND
, CLAIM_CLSD_IND AS CLAIM_CLSD_IND
, C92_APLCT_STS_CODE AS C92_APLCT_STS_CODE
, C92_APLCT_ALWD_DATE  AS C92_APLCT_ALWD_DATE
, C92_APLCT_DSLWD_DATE AS C92_APLCT_DSLWD_DATE
, CAST(CO_PAID_WEEK_QTY AS SMALLINT) AS CO_PAID_WEEK_QTY
, FLNG_DATE  AS FLNG_DATE
, ESTMT_RTW_DATE AS ESTMT_RTW_DATE
, RTW_DATE AS RTW_DATE
, DTH_DATE AS DTH_DATE
, REHAB_START_DATE AS REHAB_START_DATE
, MMI_DATE AS MMI_DATE
, CLAIM_FIRST_DCSN_DATE AS CLAIM_FIRST_DCSN_DATE
, LAST_CMPNS_PAID_DATE AS LAST_CMPNS_PAID_DATE
, COALESCE(LAST_COMP_STOP_DATE,B_LAST_COMP_STOP_DATE) AS LAST_CMPNS_STOP_DATE
, LAST_DPNDN_BNFT_PAID_DATE AS LAST_DPNDN_BNFT_PAID_DATE
, LAST_DTH_BNFT_PAY_DATE AS LAST_DTH_BNFT_PAY_DATE
, LAST_DTH_BNFT_STOP_DATE AS LAST_DTH_BNFT_STOP_DATE
, LAST_LM_PAID_DATE AS LAST_LM_PAID_DATE
, COALESCE(LAST_LM_STOP_DATE, B_LAST_LM_STOP_DATE) AS LAST_LM_STOP_DATE
, LAST_FD_PAID_DATE AS LAST_FD_PAID_DATE
, LAST_FD_STOP_DATE AS LAST_FD_STOP_DATE
, LAST_PP_STOP_DATE AS LAST_PP_STOP_DATE
, LAST_PRCNT_PP_PAID_DATE AS LAST_PRCNT_PP_PAID_DATE
, LAST_CO_STOP_DATE AS LAST_CO_STOP_DATE
, LAST_WL_STOP_DATE AS LAST_WL_STOP_DATE
, LAST_TT_PAID_DATE AS LAST_TT_PAID_DATE
, LAST_TT_STOP_DATE AS LAST_TT_STOP_DATE
, LAST_TP_STOP_DATE AS LAST_TP_STOP_DATE
, LAST_MDCL_SRVC_DATE AS LAST_MDCL_SRVC_DATE
, COALESCE(A.LAST_MED_PAY_DATE, B_LAST_MED_PAY_DATE) AS LAST_MDCL_PAID_DATE     
, coalesce(LAST_PREDICTION_DATE, LAST_PREDICTION) AS LAST_PRDCNT_DATE
, CAST(TOTAL_INCRD_AMT AS DECIMAL(15,2)) AS TOTAL_INCRD_AMT
, CAST(TOTAL_PAID_AMT AS DECIMAL(15,2)) AS TOTAL_PAID_AMT
, CAST(TOTAL_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS TOTAL_ORGNL_RSRV_AMT
, CAST(TOTAL_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS TOTAL_ADJST_RSRV_AMNT
, CAST(TOTAL_PBLSH_RSRV_AMT AS DECIMAL(15,2)) AS TOTAL_PBLSH_RSRV_AMT
, CAST(COALESCE(TOTAL_INDEMNITY_PAID,TTL_INDEM_PAID) AS DECIMAL(15,2)) AS TOTAL_INDMN_PAID_AMT
, CAST(DTH_BNFT_INCRD_AMT AS DECIMAL(15,2)) AS DTH_BNFT_INCRD_AMT
, CAST(COALESCE(DTH_PAID, DEATH_PAID_AMT) AS DECIMAL(15,2)) AS DTH_BNFT_PAID_AMT
, CAST(DTH_BNFT_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS DTH_BNFT_ORGNL_RSRV_AMT
, CAST(DTH_BNFT_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS DTH_BNFT_ADJST_RSRV_AMNT
, DTH_BNFT_PRDCT_IND AS DTH_BNFT_PRDCT_IND
, CAST(LM_INCRD_AMT AS DECIMAL(15,2)) AS LM_INCRD_AMT
, CAST(LM_PAID_AMT AS DECIMAL(15,2)) AS LM_PAID_AMT
, CAST(LM_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS LM_ORGNL_RSRV_AMT
, CAST(LM_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS LM_ADJST_RSRV_AMNT
, LM_PRDCT_IND AS LM_PRDCT_IND
, CAST(MDCL_INCRD_AMT AS DECIMAL(15,2)) AS MDCL_INCRD_AMT
, CAST(COALESCE(MED_PAID, TTL_MED_PAID_AMT) AS DECIMAL(15,2)) AS MDCL_PAID_AMT
, CAST(MDCL_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS MDCL_ORGNL_RSRV_AMT
, CAST(MDCL_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS MDCL_ADJST_RSRV_AMNT
, MDCL_PRDCT_IND AS MDCL_PRDCT_IND
, CAST(PT_INCRD_AMT AS DECIMAL(15,2)) AS PT_INCRD_AMT
, CAST(PT_PAID_AMT AS DECIMAL(15,2)) AS PT_PAID_AMT
, CAST(PT_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS PT_ORGNL_RSRV_AMT
, CAST(PT_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS PT_ADJST_RSRV_AMNT
, PT_PRDCT_IND AS PT_PRDCT_IND
, CAST(FD_INCRD_AMT AS DECIMAL(15,2)) AS FD_INCRD_AMT
, CAST(FD_PAID_AMT AS DECIMAL(15,2)) AS FD_PAID_AMT
, CAST(FD_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS FD_ORGNL_RSRV_AMT
, CAST(FD_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS FD_ADJST_RSRV_AMNT
, FD_PRDCT_IND AS FD_PRDCT_IND
, CAST(CO_INCRD_AMT AS DECIMAL(15,2)) AS CO_INCRD_AMT
, CAST(CO_PAID_AMT AS DECIMAL(15,2)) AS CO_PAID_AMT
, CAST(CO_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS CO_ORGNL_RSRV_AMT
, CAST(CO_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS CO_ADJST_RSRV_AMNT
, CO_PRDCT_IND AS CO_PRDCT_IND
, CAST(SUM_PP_PRCNT_PP_INCRD_AMT AS DECIMAL(15,2)) AS SUM_PP_PRCNT_PP_INCRD_AMT
, CAST(SUM_PP_PRCNT_PP_PAID_AMT AS DECIMAL(15,2)) AS SUM_PP_PRCNT_PP_PAID_AMT
, CAST(SUM_PP_PRCNT_PP_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS SUM_PP_PRCNT_PP_ORGNL_RSRV_AMT
, CAST(SUM_PP_PRCNT_PP_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS SUM_PP_PRCNT_PP_ADJST_RSRV_AMNT
, NULL AS PP_PRCNT_PP_PRDCT_IND -- CAST(PPG_Prediction_Flag AS VARCHAR) this is not available in the validation extract. is this derived value?
, CAST(SUM_TP_TT_WG_INCRD_AMT AS DECIMAL(15,2)) AS SUM_TP_TT_WG_INCRD_AMT
, CAST(SUM_TP_TT_WG_PAID_AMT AS DECIMAL(15,2)) AS SUM_TP_TT_WG_PAID_AMT
, CAST(SUM_TP_TT_WG_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS SUM_TP_TT_WG_ORGNL_RSRV_AMT
, CAST(SUM_TP_TT_WG_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS SUM_TP_TT_WG_ADJST_RSRV_AMNT
, TP_TT_WL_PRDCT_IND AS TP_TT_WL_PRDCT_IND
, CAST(OIG_INCRD_AMT AS DECIMAL(15,2)) AS OIG_INCRD_AMT

, CAST(OIG_PAID_AMT AS DECIMAL(15,2)) AS OIG_PAID_AMT
, CAST(OIG_ORGNL_RSRV_AMT AS DECIMAL(15,2)) AS OIG_ORGNL_RSRV_AMT
, CAST(OIG_ADJST_RSRV_AMNT AS DECIMAL(15,2)) AS OIG_ADJST_RSRV_AMNT
, CAST(SLRY_CNTNT_AMT AS DECIMAL(15,2)) AS SLRY_CNTNT_AMT
, CAST(SLRY_CNTNT_RDCTN_AMT AS DECIMAL(15,2)) AS SLRY_CNTNT_RDCTN_AMT
, CAST(SLRY_CNTNT_LM_RDCTN_AMT AS DECIMAL(15,2)) AS SLRY_CNTNT_LM_RDCTN_AMT
, CAST(SLRY_CNTNT_OTH_LM_RDCTN_AMT AS DECIMAL(15,2)) AS SLRY_CNTNT_OTH_LM_RDCTN_AMT
, CAST(MDCL_RDCTN_AMT AS DECIMAL(15,2)) AS MDCL_RDCTN_AMT
, CAST(LM_LMWL_RDCTN_AMT AS DECIMAL(15,2)) AS LM_LMWL_RDCTN_AMT
, CAST(COALESCE(LSS_AMOUNT,B_LSS_AMOUNT) AS DECIMAL(15,2)) AS LUMP_SUM_STLMN_AMT
, CAST(case when PP_PAID_AMT is null then '0.00' else PP_PAID_AMT end AS DECIMAL(15, 2)) AS PP_PRCNT_PP_PAID_AMT
, CAST(case when DEPENDENTS_QTY is null then 0 else DEPENDENTS_QTY end AS INT) AS DPNDN_QTY
, CURRENT_TIMESTAMP AS CRT_DTTM
, 'MIRA_RSRV_PRCS' AS CRT_PRGRM_NAME
FROM 
A